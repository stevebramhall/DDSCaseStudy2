---
title: "Employe Attrition Study"
author: "Steve Bramhall, Hayley Horn"
date: "December 5, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE) # each code chunk will have their own echo control
```

```{r message=FALSE, warning=FALSE}
# Load Libraries
library(dplyr)      # for string functions
library(ggplot2)    # for plots
library(gridExtra)  # for plots formatting
library(kableExtra) # for table formatting
library(knitr)      # for presenting in html
library(Hmisc)      # for describing data
library(caret)      # for classification & regression training
library(mlr)        # for machine learing
library(class)      # for classification funtions
library(corrplot)   # for correlation matrix
library(data.table)
library(mltools)

```

<h4>Abstract</h4>
Employees are valuable assets of an organization, and the unexpected departure of a key employee can be disruptive and costly. Employee Benefit News (EBN) reports that it costs employers 33% of a worker's annual salary to hire a replacement if that worker leaves. An internal measure of factors associated with an employee's potential attrition can help management either intervene or mitigate the disruption caused by unplanned staff turnover. This analysis is designed to identify determinants factors of employee attrition. A range of variables were reviewed that fell under the following categories: tenure, training and development opportunities, compensation, management/leadership, work environment, social support, and some attitudindal measures.<br>

The study reached the conclusion that there are certain indicators, that when present are a reasonable indicator that an employee shows signs consistent with attrition. There are also additional findings that hint to was to improve employee retention, which are opportunities to retain staff and reduce the risk of attrition.

<h4>Keywords</h4>
Talent Mangement, Employee Attrition, Determining Factors, Retention

<h4>Data Input</h4>
The training and validation data sets were read into data frames. We combined the data frames to one data frame to clean all the data at the same time.
```{r echo = TRUE}
# Read employee data from the training csv file and name the dataset train.
train <- read.csv(".\\InputFiles\\CaseStudy2-data.csv",header=TRUE,stringsAsFactors = TRUE,sep=",",encoding = "UTF-8")

# Read employee data from the validation csv file and names the dataset train.
validate <- read.csv(".\\InputFiles\\CaseStudy2Validation.csv",header=TRUE,stringsAsFactors = TRUE,sep=",",encoding = "UTF-8")

alldata = rbind(train,validate) # create dataframe with all data to clean all at same time
```

<h4>Data Exploration</h4>
There are 1170 observations with 37 variables (9 factors, 27 integers, 1 random number)

The following initial assessments/actions were completed:<br>
- Reviewed the data to confirm factor/categorical variable values exist in both.<br>
- Removed variables where all values are the same: StandardHours, EmployeeCount, Over18<br>
- Removed unrelated variable Rand<br>
- Recoded Attrition to 0=No, 1=Yes<br>

We classified the variables into 5 areas:
Demographics: Age, Gender, Marital Status, Education, Education Level and Distance from home (commute)
Attitudinal: Environmental Satisfaction, Job Satisfaction, Relationship Satisfaction, WorkLifeBalance,Job Involvement, Performance Rating 
Work Demographics: Job ROle, Job Level, Business Travel, Department, Training 
Financial: Daily Rate, Hourly Rate, Monthly Income, Monthly Rate, Overtime, Percent Salary Hike, Stock Option Levels

```{r DE}
                                                                                  #Confirm with Sadler if he wants this in our RMD
# HMisc provides more details than str(alldata)
#Hmisc::describe(alldata, digits = 2, tabular = TRUE)
# There are 1170 observations with 37 variables (9 factors, 27 integers, 1 random number)

# Reviewed train and validate data to confirm factor/categorical variable values exist in both
# Remove variables where all values are the same: StandardHours, EmployeeCount, Over18
# Remove unrelated variable Rand
alldata <- select(alldata,-c(StandardHours, EmployeeCount, Over18, Rand))

##Manually created data dictionary based on results below with a notes field
#DataDict <- read.csv(".\\InputFiles\\DataDictionary",header=TRUE,sep=",",encoding = "UTF-8")


```

```{r Mutate_for_EDA}
plotalldata <- alldata %>% mutate(

Age = as.factor                                                                  #Source Pew Research as of 3/1/18
(ifelse(Age %in% 0:21,"Gen Z", ifelse(Age %in% 22:37,"Millenial", 
ifelse(Age %in% 38:53,"Gex X", ifelse(Age %in% 54:72,"Boomers", 
                                      "Silent"))))),
#http://www.pewresearch.org/fact-tank/2018/03/01/defining-generations-where-millennials-end-and-post-millennials-begin/

DistanceFromHome = as.factor                                                                  #Source Pew Research as of 3/1/18
(ifelse(DistanceFromHome %in% 0:2,"2 miles or less", ifelse(DistanceFromHome %in% 3:5,"3-5 miles", 
 ifelse(DistanceFromHome %in% 6:10,"6-9 miles", ifelse(DistanceFromHome  %in% 10:15,"10-15 miles",
"16 miles or more"))))),

Education = as.factor                                                            #Source lastresearch project, best estimate of values
(ifelse(Education == 1,"Highschool or GED", ifelse(Education == 2, "Some College", 
ifelse(Education == 3, "College Graduate", ifelse(Education == 4, "Some Post Graduate",
"Post Graduate degree"))))),
  
EnvironmentSatisfaction = as.factor                                              #4 point Likert, best estimate of values
(ifelse(EnvironmentSatisfaction == 1, "Low",ifelse(EnvironmentSatisfaction == 2, "Medium", 
ifelse(EnvironmentSatisfaction == 3, "High", "Very High")))),

JobInvolvement = as.factor                                                       #4 point Likert, best estimate of values
(ifelse(JobInvolvement == 1, "Low",ifelse(JobInvolvement == 2, "Medium",
ifelse(JobInvolvement == 3, "High","Very High")))),

JobLevel = as.factor                                                       #5 point Scale estimate of values
(ifelse(JobLevel == 1, "Contributor",ifelse(JobLevel == 2, "Supervisor",
ifelse(JobLevel == 3, "Manager",ifelse(JobLevel == 4, "Director",
"Company Leadership"))))),

JobSatisfaction = as.factor                                                      #4 point Likert, best estimate of values
(ifelse(JobSatisfaction == 1, "Low",ifelse(JobSatisfaction == 2, "Medium",
ifelse(JobSatisfaction == 3, "High","Very High")))),

PerformanceRating = as.factor                                                    #4 point Likert, best estimate of values
(ifelse(PerformanceRating == 1, "Low",ifelse(PerformanceRating == 2, "Medium",
ifelse(PerformanceRating == 3, "High", "Very High")))),

RelationshipSatisfaction = as.factor                                             #4 point Likert, best estimate of values
(ifelse(RelationshipSatisfaction == 1, "Low",ifelse(RelationshipSatisfaction == 2, "Medium",
ifelse(RelationshipSatisfaction == 3, "High", "Very High")))),

WorkLifeBalance = as.factor                                                        #4 point Likert, best estimate of values
(ifelse(WorkLifeBalance == 1, "Low",ifelse(WorkLifeBalance == 2, "Medium",
ifelse(WorkLifeBalance == 3, "High", "Very High"))))
)
```




```{r}

sp <- ggplot(alldata, aes(x=PercentSalaryHike, y=YearsAtCompany)) + geom_point(shape=1)
sp
```


In the demographic data, it is as expected
```{R DemoCounts} 
#Plot Counts for High Level View
#Demographics: Age, Gender, Marital Status, Education, Education Level and Distance from home (commute)

AgePlot <- plotalldata %>% group_by(Age) %>%  summarise(counts = n()) %>%
  ggplot(aes(x = as.factor(Age), y = counts)) +
  geom_bar(stat = 'identity', fill = "light blue",col = "white") +
  ggtitle("Age") + ylab("Count") + theme_minimal() +       
  geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

GenderPlot <- plotalldata %>%   group_by(Gender) %>%  summarise(counts = n()) %>%
  ggplot(aes(x = as.factor(Gender), y = counts)) +
  geom_bar(stat = 'identity', fill = "light blue",col = "white") +
  ggtitle("Gender") + ylab("Count") + theme_minimal() +       
  geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

MaritalStatusPlot <- plotalldata %>%   group_by(MaritalStatus) %>%  summarise(counts = n()) %>%
  ggplot(aes(x = as.factor(MaritalStatus), y = counts)) +
  geom_bar(stat = 'identity', fill = "light blue",col = "white") +
  ggtitle("MaritalStatus") + ylab("Count") + theme_minimal() +       
  geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

EducationPlot <- plotalldata %>% group_by(Education) %>%  summarise(counts = n()) %>%
  ggplot(aes(x = as.factor(Education), y = counts)) +
  geom_bar(stat = 'identity', fill = "light blue",col = "white") +
  ggtitle("Education") + ylab("Count") + theme_minimal() +       
  geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

EducationFieldPlot <- plotalldata %>%   group_by(EducationField) %>%  summarise(counts = n()) %>%
  ggplot(aes(x = as.factor(EducationField), y = counts)) +
  geom_bar(stat = 'identity', fill = "light blue",col = "white") +
  ggtitle("EducationField") + ylab("Count") + theme_minimal() +       
  geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

CommutePlot <- plotalldata %>%   group_by(DistanceFromHome) %>%  summarise(counts = n()) %>%
  ggplot(aes(x = as.factor(DistanceFromHome), y = counts)) +
  geom_bar(stat = 'identity', fill = "light blue",col = "white") +
  ggtitle("Commute") + ylab("Count") + theme_minimal() +       
  geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

grid.arrange(AgePlot, GenderPlot, MaritalStatusPlot, EducationPlot, EducationFieldPlot,CommutePlot,  nrow = 2, ncol = 3)
```

In the demographic data, the JobPerformanceRating is unusual, there are only employees marked "high" and "very high". This warrants follow up, as there is an expected relationship between low performers and attrition, the absences of low performers makes the model less reliable. 

The Satisfaction ratings are also left skewed, which means there may be an issue with how the satisfaction numbers are measured, there could be evidence that employees may feel pressured to score high, or again the low performing employees could be not in the sample.
```{r Attitudinal}
#Plot Counts for High Level View
#Attitudinal: Environmental Satisfaction, Job Satisfaction, Relationship Satisfaction, WorkLifeBalance,Job Involvement, Performance Rating 

EnvironSatPlot <- plotalldata %>%  group_by(EnvironmentSatisfaction) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(EnvironmentSatisfaction), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("EnvironmentSatisfaction") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

JobSatPlot <- plotalldata %>%   group_by(JobSatisfaction) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(JobSatisfaction), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("JobSatisfaction") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

RelatSatPlot <- plotalldata %>%  group_by(RelationshipSatisfaction) %>%  summarise(counts = n()) %>%
   ggplot(aes(x = as.factor(RelationshipSatisfaction), y = counts)) +
   geom_bar(stat = 'identity', fill = "light blue",col = "white") +
   ggtitle("RelationshipSatisfaction") + ylab("Count") + theme_minimal() +       
   geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

WoLiBaPlot <- plotalldata %>%  group_by(WorkLifeBalance) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(WorkLifeBalance), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("WorkLifeBalance") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

JobInvPlot <- plotalldata %>%   group_by(JobInvolvement) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(JobInvolvement), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("JobInvolvement") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 
  
PerfRatingPlot <- plotalldata %>%  group_by(PerformanceRating) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(PerformanceRating), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("PerformanceRating") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 


grid.arrange(EnvironSatPlot, JobSatPlot, RelatSatPlot, WoLiBaPlot, JobInvPlot, PerfRatingPlot, nrow = 2, ncol = 3)



```

```{r Work Demographics}

#Plot Counts for High Level View
#Work Demographics: Job ROle, Job Level, Business Travel, Department, Training 
#distribution of work demo details. Expect Right tail.

JobLevelPlot <- plotalldata %>%   group_by(JobLevel) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(JobLevel), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("JobLevel") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

JobRolePlot <- plotalldata %>%   group_by(JobRole) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(JobRole), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("JobRole") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

BusinessTravelPlot <-  plotalldata %>%   group_by(BusinessTravel) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(BusinessTravel), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("BusinessTravel") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

DepartmentPlot <-  plotalldata %>%   group_by(Department) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(Department), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("Department") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank())

TrainingPlot <-  plotalldata %>%   group_by(TrainingTimesLastYear) %>%  summarise(counts = n()) %>%
    ggplot(aes(x = as.factor(TrainingTimesLastYear), y = counts)) +
    geom_bar(stat = 'identity', fill = "light blue",col = "white") +
    ggtitle("TrainingTimesLastYear") + ylab("Count") + theme_minimal() +       
    geom_text(aes(label=counts), size = 2.5, position=position_dodge(width=0.3), vjust=-0.25) +
  theme(plot.title = element_text(size =10),axis.title.x=element_blank())

YearsAtCompanyPlot <- ggplot(plotalldata) + 
  geom_histogram(aes(YearsAtCompany), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("YearsAtCompany") + ylab("Count") + theme_minimal()+       
  theme(plot.title = element_text(size =10),axis.title.x=element_blank())                                        # add main & axis titles

YearsInCurrentRolePlot <- ggplot(plotalldata) + 
  geom_histogram(aes(YearsInCurrentRole), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("YearsInCurrentRole") + ylab("Count") + theme_minimal() +                                       # add main & axis titles
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 
  
YearsSinceLastPromotionPlot <- ggplot(plotalldata) + 
  geom_histogram(aes(YearsSinceLastPromotion), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("YearsSinceLastPromotion")+ ylab("Count") + theme_minimal() +                                       # add main & axis titles
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

YearsWithCurrManagerPlot<- ggplot(plotalldata) + 
  geom_histogram(aes(YearsWithCurrManager), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("YearsWithCurrManager") + ylab("Count") + theme_minimal() +                                      # add main & axis titles
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 


grid.arrange(JobLevelPlot, JobRolePlot, BusinessTravelPlot ,DepartmentPlot, TrainingPlot, YearsAtCompanyPlot, YearsInCurrentRolePlot, YearsSinceLastPromotionPlot,YearsWithCurrManagerPlot,  nrow = 5, ncol = 2)

```


#this section doesn't run
#Financial: Daily Rate, Hourly Rate, Monthly Income, Monthly Rate, Overtime, Percent Salary Hike, Stock Option Levels

HourlyRatePlot <- ggplot(plotalldata) + 
  geom_histogram(aes(HourlyRate), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("HourlyRate") + ylab("Count") + theme_minimal()+       
 theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

DailyRatePlot <- ggplot(plotalldata) + 
  geom_histogram(aes(DailyRate), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("DailyRate") + ylab("Count") + theme_minimal()+       
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

MonthlyRatePlot <- ggplot(plotalldata) + 
  geom_histogram(aes(MonthlyRate), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("MonthlyRate") + ylab("Count") + theme_minimal()+       
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

MonthlyIncomePlot <- ggplot(plotalldata) + 
  geom_histogram(aes(MonthlyIncome), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("MonthlyIncome") + ylab("Count") + theme_minimal()+       
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

Overtimeplot <- ggplot(plotalldata) + 
  geom_histogram(aes(OverTime), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("OverTime") + ylab("Count") + theme_minimal()+       
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

PercentSalaryHikePlot <- ggplot(plotalldata) + 
  geom_histogram(aes(PercentSalaryHike), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("SalaryHike") + ylab("Count") + theme_minimal()+       
  theme(plot.title = element_text(size =10),axis.title.x=element_blank())

StockOptionPlot <-  ggplot(plotalldata) + 
  geom_histogram(aes(StockOptionLevel), binwidth = 1, fill = "light blue",col = "white") + 
  ggtitle("StockOptionPlot") + ylab("Count") + theme_minimal() +       
  theme(plot.title = element_text(size =10),axis.title.x=element_blank()) 

grid.arrange( HourlyRatePlot, DailyRatePlot, MonthlyRatePlot, MonthlyIncomePlot,
              Overtimeplot, PercentSalaryHikePlot, StockOptionPlot, nrow = 3, ncol = 3)

```{R attritionby}
# Attrition by Age

aage <- ggplot(plotalldata,aes(x=Gender,fill=Attrition)) + facet_grid(sex ~ .)
  ggtitle("Attrition by Age") + ylab("Count") +                                             # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  #geom_bar(stat="count",position=position_dodge())                                          # side-by-side bars
      

# Attrition by Gender
agender <- ggplot(plotalldata,aes(x=Gender) + 
  ggtitle("Attrition by Gender") + ylab("Count") +                                          # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25)

# Attrition by Marital Status
amaritalstatus <- ggplot(plotalldata, aes(x=MaritalStatus,fill=Attrition)) +
  ggtitle("Attrition by Marital Status") + ylab("Count") +                                      # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25)

# Attrition by Education
aeducation <- ggplot(plotalldata,aes(x=Education,fill=Attrition)) +
  ggtitle("Attrition by Education") + ylab("Count") +                                 # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(stat="count",position=position_dodge())                                          # side-by-side bars
      

# Attrition by EducationField
aedufield <- ggplot(plotalldata,aes(x=EducationField,fill=Attrition)) +
  ggtitle("Attrition by Education Field") + ylab("Count") +                                 # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(stat="count",position=position_dodge())                                          # side-by-side bars

# Attrition by Commute
acommute <- ggplot(plotalldata,aes(x=DistanceFromHome,fill=Attrition)) +
  ggtitle("Attrition by Commute") + ylab("Count") +                                 # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(stat="count",position=position_dodge())                                          # side-by-side bars

grid.arrange(aage, agender,amaritalstatus, aeducation, aedufield, acommute, nrow = 3, ncol = 2)
```


```{r}
# Attrition by Age
a2gender <- ggplot(alldata,aes(x= JobLevel)) + geom_histogram(binwidth=1,colour="white")
a2gender+ facet_grid(Attrition ~ Gender, scales="free", space="free")                                         # add main & axis titles

# Attrition by Age
a2gender <- ggplot(alldata,aes(x= DistanceFromHome)) + geom_histogram(binwidth=1,colour="white")
a2gender+ facet_grid(Attrition ~ ., scales="free", space="free")                                         # add main & axis titles

# Attrition by Age
a2gender <- ggplot(alldata,aes(x= RelationshipSatisfaction)) + geom_histogram(binwidth=1,colour="white")
a2gender+ facet_grid(Attrition ~ ., scales="free", space="free")                                         # add main & axis titles


# Attrition by Age
a2gender <- ggplot(alldata,aes(x= RelationshipSatisfaction)) + geom_histogram(binwidth=1,colour="white")
a2gender+ facet_grid(Attrition ~ Gender, scales="free", space="free")          

```



```{r}
# Attrition by Education
ggplot(plotalldata,aes(x=Education,fill=Attrition)) +
  ggtitle("Attrition by Education") + ylab("Count") +                                       # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25)
```

```{r}
ggplot(plotalldata,aes(x=EducationField,fill=Attrition)) +
  ggtitle("Attrition by Education Field") + ylab("Count") +                                 # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25)
      
```

```{r}
ggplot(plotalldata,aes(x=EducationField,fill=Attrition)) +
  ggtitle("Attrition by Education Field") + ylab("Count") +                                 # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25)
      
```




```{r}
ggplot(plotalldata,aes(x=JobSatisfaction,fill=Attrition)) +
  ggtitle("Attrition by JobSatisfaction") + ylab("Count") +                                 # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25) 
      
```

```{r}
ggplot(plotalldata,aes(x=PercentSalaryHike
,fill=Attrition)) +
  ggtitle("Attrition by Job Role") + ylab("Count") +                                        # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25) +
  theme(axis.text.x=element_text(angle=70,hjust=1))
      
```

```{r}
ggplot(plotalldata,aes(x=JobLevel,fill=Attrition)) +
  ggtitle("Attrition by Job Level") + ylab("Count") +                                       # add main & axis titles
  scale_fill_brewer(palette="Paired")+ theme_minimal() +                                    # change color palette
  geom_bar(aes(y = (..count..)),position=position_dodge()) +                                # side-by-side bars
  geom_text(aes(y = (..count..),label =   ifelse((..count..)==0,"",                         # label bars by %
            scales::percent((..count..)/sum(..count..)))), stat="count",
            position=position_dodge(width=0.9),vjust=-0.25) +
  theme(axis.text.x=element_text(angle=70,hjust=1))
      
```
```{r}
# Split data to create 2 correlation matrices, more readable
data2<-alldata;                                                                           # create 1st data set for corr matrix
data2$Attrition <- ifelse(data2[,3] == "Yes", 1, ifelse(data2[,3] == "No", 0, 99))        # Recode Attrition with 0s and 1s
data3<-data2;                                                                             # create 2nd data set for corr matrix
data2[21:33]<-list(NULL)                                                                  # reduce 1st data set
data3[2]<-list(NULL)                                                                      # reduce 2nd data set, keeping  Attrition
data3[3:19]<-list(NULL)
M_df1 <- select_if(data2, is.numeric)                                                     # get all numeric data
M1 <- cor(M_df1)                                                                          # convert to matrix
corrplot(M1, order="hclust",addrect=2)                                                    # Display the correlation coefficient
M_df2 <- select_if(data3, is.numeric)                                                     # get all numeric data
M2 <- cor(M_df2)                                                                          # convert to matrix
corrplot(M2, order="hclust",addrect=2)                                                    # Display the correlation coefficient
#-----
data4<-alldata;                                                                           # create 1st data set for corr matrix
data4$Attrition <- ifelse(data4[,3] == "Yes", 1, ifelse(data4[,3] == "No", 0, 99))        # Recode Attrition with 0s and 1s
data4<-data4[,-2]                                                                         # remove age
data4<-data4[,-18]                                                                        # remove monthly income
data4<-data4[,-23]                                                                        # remove total working years
data4<-data4[,-29]                                                                        # remove years since last promotion
data4<-data4[,-28]                                                                        # remove years in current role
data4<-data4[,-27]                                                                        # remove years at company
M_df3 <- select_if(data4, is.numeric)                                                     # get all numeric data
M3 <- cor(M_df3)                                                                          # convert to matrix
corrplot(M1, order="hclust",addrect=2)                                                    # Display the correlation coefficient
train2 <- data4[1:1170,]                                                                  # Create new training set
train2$Attrition <- as.factor(ifelse(train2[,2] == 1, "Yes", ifelse(train2[,2] == 0, "No", 99)))     # Recode Attrition back to Yes and No
```
